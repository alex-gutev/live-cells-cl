<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Cell Value Forms &#8212; live-cells-cl 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d7e2fa82" />
    <link rel="stylesheet" type="text/css" href="../_static/cldomain.css?v=e67a0556" />
    <script src="../_static/documentation_options.js?v=01f34227"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../reference.html" />
    <link rel="prev" title="Cells" href="cells.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Lora:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../reference.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cells.html" title="Cells"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">live-cells-cl 0.1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Cell Value Forms</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="cell-value-forms">
<h1>Cell Value Forms<a class="headerlink" href="#cell-value-forms" title="Link to this heading">¶</a></h1>
<p>This page goes over some tools that can be used when writing the
<em>value forms</em> of cells.</p>
<section id="aborting-a-computation">
<h2>Aborting a computation<a class="headerlink" href="#aborting-a-computation" title="Link to this heading">¶</a></h2>
<p>The computation of a computed cell’s value can be aborted using the
<a class="reference internal" href="../reference.html#function:live-cells:none" title="live-cells:none"><code class="xref cl cl-function docutils literal notranslate"><span class="pre">NONE</span></code></a> function. When <a class="reference internal" href="../reference.html#function:live-cells:none" title="live-cells:none"><code class="xref cl cl-function docutils literal notranslate"><span class="pre">NONE</span></code></a> is called
inside a computed cell, the value form is exited and the cell’s
current value is preserved. This can be used to prevent a cell’s value
from being recomputed when a condition is not met.</p>
<div class="highlight-common-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">defcell</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="p">(</span><span class="nv">defcell</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="p">(</span><span class="nv">none</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
<span class="p">(</span><span class="nb">pprint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="c1">; Prints 6</span>

<span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="mi">15</span><span class="p">)</span>
<span class="p">(</span><span class="nb">pprint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="c1">; Prints 6</span>

<span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span>
<span class="p">(</span><span class="nb">pprint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="c1">; Prints 8</span>
</pre></div>
</div>
<p>In this example the computed cell <code class="docutils literal notranslate"><span class="pre">B</span></code> evaluates to the value of
<code class="docutils literal notranslate"><span class="pre">A</span></code> if it is less than <code class="docutils literal notranslate"><span class="pre">10</span></code>. Otherwise its current value is
preserved with <code class="docutils literal notranslate"><span class="pre">(NONE)</span></code>. When the value of <code class="docutils literal notranslate"><span class="pre">A</span></code> is set to <code class="docutils literal notranslate"><span class="pre">15</span></code>,
<code class="docutils literal notranslate"><span class="pre">B</span></code> keeps its existing value <code class="docutils literal notranslate"><span class="pre">8</span></code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The symbol <a class="reference internal" href="../reference.html#function:live-cells:none" title="live-cells:none"><code class="xref cl cl-symbol docutils literal notranslate"><span class="pre">NONE</span></code></a> is equivalent to calling
<a class="reference internal" href="../reference.html#function:live-cells:none" title="live-cells:none"><code class="xref cl cl-function docutils literal notranslate"><span class="pre">NONE</span></code></a> with no arguments. This definition of <code class="docutils literal notranslate"><span class="pre">B</span></code> can
be rewritten as:</p>
<div class="highlight-common-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">defcell</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">none</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>If <a class="reference internal" href="../reference.html#function:live-cells:none" title="live-cells:none"><code class="xref cl cl-function docutils literal notranslate"><span class="pre">NONE</span></code></a> is called while computing the initial value of
the cell, the cell is initialized to the value provided in the
optional argument to <a class="reference internal" href="../reference.html#function:live-cells:none" title="live-cells:none"><code class="xref cl cl-function docutils literal notranslate"><span class="pre">NONE</span></code></a>, which defaults to <a class="reference external" href="http://www.lispworks.com/reference/HyperSpec/Body/a_nil.htm" title="(in Hyperspec)"><code class="docutils literal notranslate"><span class="pre">NIL</span></code></a> if
no argument is given.</p>
<p>The following definition of <code class="docutils literal notranslate"><span class="pre">B</span></code> ensures that its value is
initialized to <code class="docutils literal notranslate"><span class="pre">1</span></code>, rather than <a class="reference external" href="http://www.lispworks.com/reference/HyperSpec/Body/a_nil.htm" title="(in Hyperspec)"><code class="docutils literal notranslate"><span class="pre">NIL</span></code></a>, if the
initial value of <code class="docutils literal notranslate"><span class="pre">A</span></code> is greater than or equal to <code class="docutils literal notranslate"><span class="pre">10</span></code>.</p>
<div class="highlight-common-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">defcell</span><span class="w"> </span><span class="nv">b</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">      </span><span class="nv">a</span>
<span class="w">      </span><span class="p">(</span><span class="nv">none</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The value of a <em>computed cell</em> is only computed if it is actually
referenced. <a class="reference internal" href="../reference.html#function:live-cells:none" title="live-cells:none"><code class="xref cl cl-function docutils literal notranslate"><span class="pre">NONE</span></code></a> only preserves the current value of
the cell, but this might not be the latest value of the cell if the
cell is only referenced conditionally. A good rule of thumb is to
use <a class="reference internal" href="../reference.html#function:live-cells:none" title="live-cells:none"><code class="xref cl cl-function docutils literal notranslate"><span class="pre">NONE</span></code></a> only to prevent a cell from holding an
invalid value.</p>
</div>
</section>
<section id="condition-handling">
<h2>Condition handling<a class="headerlink" href="#condition-handling" title="Link to this heading">¶</a></h2>
<p>Conditions signaled during the computation of a cell’s value are
resignaled when the cell’s value is referenced. This allows conditions
to be handled in cells directly using <code class="xref cl cl-macro docutils literal notranslate"><span class="pre">HANDLER-BIND</span></code> and
<code class="xref cl cl-macro docutils literal notranslate"><span class="pre">HANDLER-CASE</span></code>.</p>
<div class="highlight-common-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">defcell</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">defcell</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="p">(</span><span class="nb">parse-integer</span><span class="w"> </span><span class="nv">text</span><span class="p">))</span>

<span class="p">(</span><span class="nv">defcell</span><span class="w"> </span><span class="nv">validp</span>
<span class="w">  </span><span class="p">(</span><span class="nb">handler-case</span><span class="w"> </span><span class="p">(</span><span class="nb">plusp</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="kt">parse-error</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="no">nil</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">live</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">validp</span>
<span class="w">      </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="s">&quot;Valid~%&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="s">&quot;The input ~w is invalid~%&quot;</span><span class="w"> </span><span class="nv">text</span><span class="p">)))</span>
</pre></div>
</div>
<p>In this example, cell <code class="docutils literal notranslate"><span class="pre">N</span></code> parses an integer from the string held in
cell <code class="docutils literal notranslate"><span class="pre">TEXT</span></code>. <code class="docutils literal notranslate"><span class="pre">VALIDP</span></code> is a computed cell that evaluates to true if
the parsed integer, held in <code class="docutils literal notranslate"><span class="pre">N</span></code>, is greater than <code class="docutils literal notranslate"><span class="pre">0</span></code>. <code class="docutils literal notranslate"><span class="pre">VALIDP</span></code>
evaluates to <a class="reference external" href="http://www.lispworks.com/reference/HyperSpec/Body/a_nil.htm" title="(in Hyperspec)"><code class="docutils literal notranslate"><span class="pre">NIL</span></code></a> if <code class="docutils literal notranslate"><span class="pre">N</span></code> is less than <code class="docutils literal notranslate"><span class="pre">0</span></code>
or an integer could not be parsed from the string held in <code class="docutils literal notranslate"><span class="pre">TEXT</span></code>,
that is a <a class="reference external" href="http://www.lispworks.com/reference/HyperSpec/Body/e_parse_.htm" title="(in Hyperspec)"><code class="docutils literal notranslate"><span class="pre">PARSE-ERROR</span></code></a> condition was signaled
while computing the value of <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p>
<p>The following assignments:</p>
<div class="highlight-common-lisp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="s">&quot;3&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="s">&quot;-1&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="s">&quot;not a number&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>result in the following being printed:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Valid
The input &quot;-1&quot; is invalid
The input &quot;not a number&quot; is invalid
Valid
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example also demonstrates that</p>
<ul class="simple">
<li><p>Live blocks can reference cells conditionally. In this case
cell <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> is only referenced when <code class="docutils literal notranslate"><span class="pre">VALIDP</span></code> is false.</p></li>
<li><p>Computed cells, <code class="docutils literal notranslate"><span class="pre">VALIDP</span></code> in this example, can be observed just
like any other cell. In-fact, the live block doesn’t care whether
a cell is computed cell or not.</p></li>
</ul>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Cell Value Forms</a><ul>
<li><a class="reference internal" href="#aborting-a-computation">Aborting a computation</a></li>
<li><a class="reference internal" href="#condition-handling">Condition handling</a></li>
</ul>
</li>
</ul>

  </div><h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation index</a><ul>
      <li>Previous: <a href="cells.html" title="previous chapter">Cells</a></li>
      <li>Next: <a href="../reference.html" title="next chapter">API Reference</a></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/basics/cell-expressions.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
  </body>
</html>